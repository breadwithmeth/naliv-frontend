# Обновление управления банковскими картами

## Описание изменений

Функциональность добавления банковских карт была перенесена из страницы оформления заказа в профиль пользователя для улучшения пользовательского опыта и логической организации функций.

## Что изменилось

### 1. Страница оформления заказа (`src/pages/Checkout.tsx`)

**Удалено:**
- Модальное окно `AddCardModal` 
- Состояние `isAddCardModalOpen`
- Функция `handleCardAdded`
- Опция "Новая карта" при выборе способа оплаты
- Кнопка "Добавить карту"

**Добавлено:**
- Информационное сообщение о добавлении карт в профиле
- Ссылка "Перейти в профиль" для пользователей без карт
- Валидация, требующая выбор карты для завершения заказа
- Сообщение об ошибке, если карта не выбрана

**Логика:**
- Теперь для оформления заказа пользователь обязательно должен выбрать одну из сохраненных карт
- Если карт нет, предлагается перейти в профиль для их добавления

### 2. Страница профиля (`src/pages/Profile.tsx`)

**Добавлено:**
- Секция "Банковские карты" с полным управлением
- Функции загрузки карт (`loadCards`)
- Функция удаления карт (`handleDeleteCard`)
- Модальное окно `AddCardModal` для добавления новых карт
- Состояние для управления картами (`cards`, `isLoadingCards`, `cardActionLoading`)
- Обработка результатов добавления карт через localStorage

**Интерфейс:**
- Карточки банковских карт в стиле кредитных карт с градиентом
- Кнопки добавления и удаления карт
- Индикаторы загрузки
- Пустое состояние с призывом к добавлению первой карты

### 3. Логика работы с картами

**API интеграция:**
- `GET /api/user/cards` - загрузка сохраненных карт
- `DELETE /api/user/cards/:id` - удаление карты
- `POST /api/payments/save-card/init` - инициализация добавления карты (возвращает HTML)

**Синхронизация:**
- Использование localStorage для передачи результатов добавления карт между страницами
- Автоматическое обновление списка карт после успешного добавления
- Уведомления пользователя об успехе/неудаче операций

## Преимущества новой архитектуры

1. **Логическая организация**: Управление картами теперь сосредоточено в профиле, где это логично ожидать
2. **Упрощение checkout**: Страница оформления заказа стала проще и фокусируется на самом заказе
3. **Лучший UX**: Пользователи могут управлять картами независимо от процесса заказа
4. **Безопасность**: Четкое разделение между добавлением карт и их использованием

## Техническая реализация

### Новый хук useCardSaving.ts
- Обновлен для работы с HTML-ответом от API
- Открывает HTML в новом окне для процесса добавления карты
- Отслеживает закрытие окна и результат операции

### Обновленные компоненты
- `Checkout.tsx`: Упрощен, убрана функциональность добавления карт
- `Profile.tsx`: Расширен секцией управления картами
- `AddCardModal.tsx`: Переиспользован в профиле

## Совместимость

- Сохранена совместимость с существующим API
- Все существующие карты продолжают работать
- Процесс оплаты не изменился для пользователей с сохраненными картами

## Что дальше

1. Пользователи без карт будут перенаправляться в профиль для их добавления
2. В профиле доступно полное управление картами
3. Страница заказа требует выбор существующей карты для продолжения
